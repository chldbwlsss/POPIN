<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.summer.popin.domain.review.dao.ReviewMapper">
    <select id="getReviewFormDataByMemberNo" resultType="ReviewReservationDTO">
        select
            r.no as reservationNo,
            r.place_no,
            r.checkin_date,
            r.checkout_date,
            p.name as placeName,
            p.region_1depth,
            p.region_2depth,
            (select url from url_resource where kind_code=3 and place_no = r.place_no) as placeThumbnail
        from
            reservation r
                    left outer join place p on (r.place_no = p.no)
        where
            r.guest_no=#{memberNo}
    </select>
    <select id="getReviewsByMemberNo" resultType="MyReviewDTO">
        select
            r.checkin_date,
            r.checkout_date,
            p.region_1depth,
            p.region_2depth,
            re.content,
            (select url from url_resource where kind_code=1 and place_no = re.place_no) as hostProfileUrl
        from review re
                left outer join place p on (re.place_no = p.no)
                left outer join reservation r on (re.reservation_no = r.no)
        where
            re.guest_no=#{memberNo} and r.checkout_date <![CDATA[<]]> sysdate
    </select>

    <insert id="insertOne">
        insert into
            review (no, place_no, guest_no, rating, content, reservation_no)
        values
            (seq_review.nextval, #{placeNo}, #{guestNo}, #{rating}, #{content}, #{reservationNo})
    </insert>
</mapper>